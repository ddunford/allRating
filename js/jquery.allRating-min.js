(function($){$.rating={defaults:{segmentContainerClass:'ratingSegmentContainer',segmentActiveClass:'ratingSegmentActive',segmentClassNonActiveClass:'ratingSegmentNonActive',segmentClass:'ratingSegment',segmentDisabledClass:'ratingEditDisabled',segmentCancelClass:'ratingSegmentCancel',segmentEditClass:'ratingSegmentEdit',outerContainerClass:'rating',hoverClass:'ratingHoverContainer',ratingContainerId:'ratingContainer',clearClass:'ratingClear',theme:'star',input:'select',existingRatingOnEdit:false,showHover:true,disabled:false,onClickEvent:function(value,input){},}};$.fn.allRating=function(options){var config=$.extend({},$.rating.defaults,options);this.each(function(){var index=$.fn.allRating._ui();$.fn.allRating.init(this,config,index);var input=$.fn.allRating.fetchInput(this,config,index);var html=$.fn.allRating.generateHtml(input,config);$(this).after(html);$.fn.allRating.addActiveStars(input,config,true);$.fn.allRating.initEvents(input,config)});return this};$.fn.allRating.init=function(item,config,index){$(item).hide();if(!$(item).attr('id')){$(item).attr('id',config.ratingContainerId+'-'+index+'-input')}};$.fn.allRating.fetchInput=function(item,config,index){var input={};input.item=$(item);input.Id=$(item).attr('id');if(typeof(item)=='string')input.ratingId=item.replace('#','').replace('-input','');else input.ratingId=config.ratingContainerId+'-'+index;switch(config.input){case'select':input.options=$(item).find('option');input.optionCount=$(input.options).length-1;input.selectedValue=$(item).find('option:selected').val();var selectedText=$(item).find('option:selected').text();input.selectedText=(null==selectedText)?'Not Rated':selectedText;input.disabled=$(item).is(':disabled');break;case'radio':input.options=$(item).find('input');input.optionCount=$(input.options).length-1;input.selectedValue=$(item).find('input[type=radio]:checked').val();var selectedText=$('label[for='+$(item).find('input[type=radio]:checked').attr('id')+']').html()input.selectedText=(null==selectedText)?'Not Rated':selectedText;input.disabled=$(item).hasClass(config.segmentDisabledClass);break;default:return input}return input};$.fn.allRating.generateHtml=function(input,config){var segmentCollection=$.fn.allRating.generateSegments(input,config);var hoverContainer='<div class="'+config.hoverClass+' '+config.theme+'">'+'<label class="existingRating">'+input.selectedText+'</label>'+'<label class="newRating"></label>'+'<div class="'+config.clearClass+'"></div>'+'</div>';return'<div class="'+config.outerContainerClass+' '+config.theme+'" id="'+input.ratingId+'">'+hoverContainer+'<div class="'+config.segmentContainerClass+'">'+segmentCollection+'</div>'+'</div><div class="'+config.clearClass+'">'+'</div>'};$.fn.allRating.generateSegments=function(input,config){return $.fn.allRating.generateSegmentHtml(config,input)};$.fn.allRating.generateSegmentHtml=function(config,input){var segmentCollection='';var disabled='';if(input.disabled)disabled=config.segmentDisabledClass;$(input.options).each(function(){segmentCollection=segmentCollection+'<a class="'+config.segmentClass+' '+disabled+' '+config.segmentClassNonActiveClass+' '+config.theme+'" rel="'+$(this).val()+'" href="#'+input.ratingId+'"></a>'});if(!input.disabled){segmentCollection=segmentCollection+'<a class="'+config.segmentCancelClass+' '+config.theme+'" rel="cancel" href="#'+input.ratingId+'"></a>'}return segmentCollection}$.fn.allRating.addActiveStars=function(input,config,original){if(original){$('#'+input.ratingId+' .'+config.segmentContainerClass).find('a[rel="'+input.selectedValue+'"]').addClass('original')}$('#'+input.ratingId+' .'+config.segmentContainerClass+' a:not(.'+config.segmentCancelClass+')').removeClass(config.segmentActiveClass).addClass(config.segmentClassNonActiveClass);$('#'+input.ratingId+' .'+config.segmentContainerClass).find('a[rel="'+input.selectedValue+'"]').removeClass(config.segmentClassNonActiveClass).addClass(config.segmentActiveClass);$('#'+input.ratingId+' .'+config.segmentContainerClass).find('a[rel="'+input.selectedValue+'"]').prevAll('a').each(function(){$(this).removeClass(config.segmentClassNonActiveClass).addClass(config.segmentActiveClass)})};$.fn.allRating.initEvents=function(input,config){$.fn.allRating.initClickEvents(input,config);$.fn.allRating.initHoverEvents(input,config)};$.fn.allRating.initClickEvents=function(input,config){$('#'+input.ratingId+' .'+config.segmentClass).click(function(){if(!$(this).hasClass(config.segmentDisabledClass)){$(this).siblings('.'+config.segmentCancelClass).fadeIn();var inputId=$(this).attr('href')+'-input';var newValue=$(this).attr('rel');var input=$.fn.allRating.updateInput(inputId,newValue,config);config.onClickEvent(input)}return false})$('#'+input.ratingId+' .'+config.segmentCancelClass).click(function(){if($($(this).attr('href')+' .'+config.segmentContainerClass+' .original').length>0)$($(this).attr('href')+' .'+config.segmentContainerClass+' .original').click();else $.fn.allRating.updateInput($(this).attr('href')+'-input',null,config);var input=$.fn.allRating.fetchInput($(this).attr('href')+'-input',config);$.fn.allRating.addActiveStars(input,config);$(this).fadeOut();return false})};$.fn.allRating.updateInput=function(inputId,newValue,config){switch(config.input){case'select':$(inputId).val(newValue);return $(inputId);break;case'radio':if(newValue!=null)$(inputId+' input[type=radio]').filter('[value='+newValue+']').attr('checked','checked');else $(inputId+' input[type=radio]').attr('checked',false);return $(inputId+' input[type=radio]').filter('[value='+newValue+']');break}};$.fn.allRating.findTextFromValue=function(input,value,config){switch(config.input){case'select':return $('#'+input.ratingId+'-input option[value="'+value+'"]').text();break;case'radio':return $('label[for='+$('#'+input.ratingId+'-input input[value="'+value+'"]').attr('id')+']').html()break}return null}$.fn.allRating.initHoverEvents=function(input,config){if(config.showHover){$('#'+input.ratingId+' .'+config.segmentContainerClass).hover(function(e){$(this).siblings('.'+config.hoverClass).css({position:'absolute',top:this.offsetTop+$('#'+input.ratingId).find('a.'+config.segmentClass).height()+4,left:this.offsetLeft});$(this).siblings('.'+config.hoverClass).fadeIn("slow")},function(){$(this).stop().siblings('.'+config.hoverClass).fadeOut("fast")});if(!input.disabled){if(config.existingRatingOnEdit)$('#'+input.ratingId+' .'+config.hoverClass+' .existingRating').prepend('Existing: ');else $('#'+input.ratingId+' .'+config.hoverClass+' .existingRating').hide();$('#'+input.ratingId).find('a.'+config.segmentClass).hover(function(){$('#'+input.ratingId+' .'+config.hoverClass+' .newRating').html('New: '+$.fn.allRating.findTextFromValue(input,$(this).attr('rel'),config))})}}$('#'+input.ratingId+' .'+config.segmentClass+':not(.'+config.segmentDisabledClass+')').hover(function(){$(this).siblings(':not(.'+config.segmentCancelClass+')').removeClass(config.segmentActiveClass).addClass(config.segmentClassNonActiveClass);$(this).prevAll('a').each(function(){$(this).removeClass(config.segmentClassNonActiveClass).addClass(config.segmentActiveClass)});$(this).removeClass(config.segmentClassNonActiveClass).addClass(config.segmentActiveClass)},function(){var input=$.fn.allRating.fetchInput($(this).attr('href')+'-input',config);$.fn.allRating.addActiveStars(input,config)})};$.fn.allRating._ui=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1)}})(jQuery);
